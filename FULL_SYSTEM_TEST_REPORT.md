# ๐ ุชูุฑูุฑ ุงูุงุฎุชุจุงุฑ ุงูุดุงูู ููุธุงู ุงููุชุงุฌุฑ

## โ ุงูุงุฎุชุจุงุฑ 1: ุชุณุฌูู ุงูุชุงุฌุฑ ูุฅุถุงูุฉ ุญุณุงุจู

### ุงููุณุงุฑ ุงูุญุงูู:
1. **ุงูุชุณุฌูู ุงูุฃููู**: `/auth` โ
   - ุงููุณุชุฎุฏู ูุณุฌู ุญุณุงุจ ุฌุฏูุฏ
   - ูุชู ุฅูุดุงุก profile ุชููุงุฆูุงู
   - ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ูููู ุชุนุทููู ููุชุทููุฑ)

2. **ุทูุจ ุฃู ูุตุจุญ ุชุงุฌุฑ**: `/merchant` โ
   - ุงููุณุชุฎุฏู ูููุฃ ูููุฐุฌ ุทูุจ ุงูุชุงุฌุฑ
   - ูุฑุณู ุงูุทูุจ ููุฃุฏูู
   - ุงูุญุงูุฉ: `pending` โ ุงูุชุธุงุฑ ููุงููุฉ ุงูุฃุฏูู

3. **ููุงููุฉ ุงูุฃุฏูู**: `/admin/merchant-requests` โ
   - ุงูุฃุฏูู ูุฑุงุฌุน ุงูุทูุจ
   - ุนูุฏ ุงูููุงููุฉุ ูุชู ุฅุถุงูุฉ role "merchant" ูููุณุชุฎุฏู
   - ุงููุณุชุฎุฏู ูุตุจุญ ุชุงุฌุฑ ุฑุณูู

---

## โ ุงูุงุฎุชุจุงุฑ 2: ุญุฏ ุงููุชุงุฌุฑ (10 ูุชุงุฌุฑ ูุญุฏ ุฃูุตู)

### ุงูุญูุงูุฉ ุงููุทุจูุฉ:

#### 1. Database Trigger (ุงูุฃููู) โ
```sql
CREATE FUNCTION public.check_store_limit()
-- ูุชุญูู ูู ุนุฏุฏ ุงููุชุงุฌุฑ ูุจู ุงูุฅุถุงูุฉ
-- ูุฑูุน Exception ุฅุฐุง ูุตู ุงููุณุชุฎุฏู ูู 10 ูุชุงุฌุฑ
```

**ุงูุงุฎุชุจุงุฑ:**
- โ ุงูุชุญูู ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุง ูููู ุชุฌุงูุฒู ูู ุฃู ูุงุฌูุฉ
- โ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ

#### 2. Frontend Check โ
```typescript
// ูู AddStoreDialog.tsx - ูุจู ุฑูุน ุงููููุงุช
const { count } = await supabase
  .from('stores')
  .select('*', { count: 'exact', head: true })
  .eq('owner_id', user.id);

if (count >= 10) {
  throw new Error("ููุฏ ูุตูุช ููุญุฏ ุงูุฃูุตู ูู ุงููุชุงุฌุฑ (10 ูุชุงุฌุฑ)");
}
```

**ุงูููุงุฆุฏ:**
- โ ุชุญุฐูุฑ ููุฑู ูููุณุชุฎุฏู
- โ ุชูููุฑ ููุงุฑุฏ (ุนุฏู ุฑูุน ุงููููุงุช)
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู

---

## โ ุงูุงุฎุชุจุงุฑ 3: ุฑูุน ุงูุตูุฑ ูุงูุฃูุงู

### ๐ ุงูุญูุงูุฉ ูู ูููุงุช PHP ูุงููููุงุช ุงูุฎุทุฑุฉ

#### 1. Storage Bucket Configuration โ
```sql
UPDATE storage.buckets
SET 
  file_size_limit = 5242880, -- 5MB
  allowed_mime_types = ARRAY[
    'image/jpeg',
    'image/jpg', 
    'image/png',
    'image/webp',
    'application/pdf'
  ]
WHERE id = 'store-documents';
```

**ุงูุญูุงูุฉ:**
- โ ุญุฏ ุฃูุตู 5MB ููู ููู
- โ ุฃููุงุน MIME ูุญุฏุฏุฉ ููุท
- โ ูุฑูุถ ุฃู ููู ุบูุฑ ูุฏุฑุฌ

#### 2. RLS Policy ุนูู Storage โ
```sql
CREATE POLICY "Prevent dangerous file uploads"
ON storage.objects
FOR INSERT
WITH CHECK (
  bucket_id = 'store-documents' AND
  (storage.foldername(name))[1] = auth.uid()::text AND
  -- Block dangerous file extensions
  name !~* '\.(php|phtml|php3|php4|php5|phps|cgi|pl|py|rb|sh|exe|bat|cmd|com|jar|jsp|asp|aspx)$'
);
```

**ุงููููุงุช ุงููุญุธูุฑุฉ:**
- โ PHP: .php, .phtml, .php3, .php4, .php5, .phps
- โ CGI/Perl: .cgi, .pl
- โ Python: .py
- โ Ruby: .rb
- โ Shell: .sh
- โ Executables: .exe, .bat, .cmd, .com
- โ Java: .jar
- โ JSP/ASP: .jsp, .asp, .aspx

#### 3. Frontend Validation โ
```typescript
const validateFile = (file: File, type: 'image' | 'document'): boolean => {
  // 1. ุญุฌู ุงูููู
  if (file.size > 5 * 1024 * 1024) return false;
  
  // 2. ุงูุงูุชุฏุงุฏุงุช ุงูุฎุทุฑุฉ
  const dangerousExtensions = /\.(php|phtml|php3|...)$/i;
  if (dangerousExtensions.test(file.name)) return false;
  
  // 3. MIME Type
  const allowedTypes = ['image/jpeg', 'image/png', ...];
  if (!allowedTypes.includes(file.type)) return false;
  
  return true;
}
```

**ุงูุชุญูู ุงูุซูุงุซู:**
1. โ ุญุฌู ุงูููู
2. โ ุงูุชุฏุงุฏ ุงูููู
3. โ ููุน MIME

#### 4. HTML Input Restrictions โ
```html
<!-- ููุตูุฑ -->
<input 
  type="file" 
  accept="image/jpeg,image/jpg,image/png,image/webp"
/>

<!-- ูููุซุงุฆู -->
<input 
  type="file" 
  accept="image/jpeg,image/jpg,image/png,application/pdf"
/>
```

---

## โ ุงูุงุฎุชุจุงุฑ 4: ุนูููุฉ ุฑูุน ุงูุตูุฑ

### ุงููุณุงุฑ ุงููุงูู:

1. **ุงุฎุชูุงุฑ ุงูููู** โ
   - ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุงูุตูุฑุฉ/ุงููุซููุฉ
   - Frontend ูุชุญูู ูู ุงูููู ููุฑุงู
   - ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ุฅุฐุง ูุงู ุบูุฑ ููุงุณุจ

2. **ุฑูุน ุฅูู Storage** โ
```typescript
const uploadFile = async (file: File, bucket: string, path: string) => {
  const { data, error } = await supabase.storage
    .from(bucket)
    .upload(path, file, {
      cacheControl: '3600',
      upsert: false
    });
  
  // RLS Policy ูุชุญูู ูู:
  // - ููุน ุงูููู
  // - ุงูุงูุชุฏุงุฏ
  // - ุตุงุญุจ ุงููุฌูุฏ
  
  return publicUrl;
}
```

3. **ุญูุธ ุงูุฑุงุจุท ูู Database** โ
```typescript
await supabase.from("stores").insert([{
  logo_url: logoUrl,
  commercial_document: documentUrl,
  // ...
}]);
```

**ุงูุฃูุงู:**
- โ ูู ูุณุชุฎุฏู ูู ูุฌูุฏ ุฎุงุต: `user_id/filename`
- โ ูุง ูููู ุงููุตูู ููููุงุช ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู
- โ Bucket ููุณ public (ุญูุงูุฉ ุฅุถุงููุฉ)

---

## โ ุงูุงุฎุชุจุงุฑ 5: ููุงููุฉ ุงูุฃุฏูู ูุธููุฑ ุงููุชุฌุฑ

### ุงููุณุงุฑ ุงููุงูู:

#### 1. ุฅุถุงูุฉ ุงููุชุฌุฑ (is_active = false) โ
```typescript
await supabase.from("stores").insert([{
  // ... ุจูุงูุงุช ุงููุชุฌุฑ
  is_active: false // ุงููุชุฌุฑ ุบูุฑ ูุดุท ูู ุงูุจุฏุงูุฉ
}]);
```

#### 2. ุตูุญุฉ ุงูุฃุฏูู `/admin/stores` โ
```typescript
const handleToggleActive = async (storeId: string, currentStatus: boolean) => {
  await supabase
    .from("stores")
    .update({ is_active: !currentStatus })
    .eq("id", storeId);
  
  // ุนูุฏ ุงูุชูุนูู: is_active = true
}
```

**ูุธุงุฆู ุงูุฃุฏูู:**
- โ ุนุฑุถ ูู ุงููุชุงุฌุฑ (ุงููุดุทุฉ ูุบูุฑ ุงููุดุทุฉ)
- โ ุชูุนูู/ุฅูุบุงุก ุชูุนูู ุงููุชุฌุฑ
- โ ุนุฑุถ ุงูุชูุงุตูู ุงููุงููุฉ
- โ ุญุฐู ุงููุชุฌุฑ (ุฅุฐุง ูุฒู)

#### 3. ุธููุฑ ูู ุตูุญุฉ ุงููุชุงุฌุฑ `/stores` โ

**RLS Policy:**
```sql
CREATE POLICY "Stores are viewable by everyone"
ON stores FOR SELECT
USING ((is_active = true) OR (owner_id = auth.uid()));
```

**ุงูุชุทุจูู:**
- โ ุงููุชุงุฌุฑ ุงููุดุทุฉ (`is_active = true`) ุชุธูุฑ ููุฌููุน
- โ ุงููุชุงุฌุฑ ุบูุฑ ุงููุดุทุฉ ุชุธูุฑ ููุท ูุตุงุญุจูุง
- โ ุงูุฃุฏูู ูุฑู ูู ุดูุก (policy ูููุตูุฉ)

```typescript
// ูู /stores
const { data: stores } = await supabase
  .from('stores')
  .select('*')
  // RLS ุชุทุจู ุชููุงุฆูุงู:
  // - ุฅุฐุง guest: ููุท is_active = true
  // - ุฅุฐุง ุตุงุญุจ ุงููุชุฌุฑ: ูุฑู ูุชุฌุฑู ุญุชู ูู ุบูุฑ ูุดุท
```

---

## ๐ฏ ููุฎุต ุงูุญูุงูุฉ ูุงูุฃูุงู

### ุทุจูุงุช ุงูุญูุงูุฉ ุงููุทุจูุฉ:

#### 1. ุญุฏ ุงููุชุงุฌุฑ (10 ูุชุงุฌุฑ):
- โ Database Trigger
- โ Frontend Check
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

#### 2. ุฑูุน ุงููููุงุช:
- โ Storage Bucket Configuration (5MB, MIME types)
- โ RLS Policy (ููุน PHP ููููุงุช ุฎุทุฑุฉ)
- โ Frontend Validation (ุญุฌูุ ุงูุชุฏุงุฏุ MIME)
- โ HTML Input accept
- โ ูุฌูุฏุงุช ูููุตูุฉ ููู ูุณุชุฎุฏู

#### 3. ููุงููุฉ ุงูุฃุฏูู:
- โ ุงููุชุงุฌุฑ ุบูุฑ ูุดุทุฉ ุจุดูู ุงูุชุฑุงุถู
- โ ุงูุฃุฏูู ููุนูู ุงููุชุฌุฑ ูุฏููุงู
- โ RLS ุชุชุญูู ูู ูู ูุฑู ูุงุฐุง

---

## ๐ ุณููุงุฑูู ุงูุงุฎุชุจุงุฑ ุงููุงูู

### ุงูุฎุทูุฉ 1: ุชุณุฌูู ุงููุณุชุฎุฏู
```
1. ูุฐูุจ ูู /auth
2. ูุณุฌู ุญุณุงุจ ุฌุฏูุฏ
3. ูุชู ุฅูุดุงุก profile ุชููุงุฆูุงู
โ ุงููุชูุฌุฉ: ุญุณุงุจ ุฌุฏูุฏ ุฌุงูุฒ
```

### ุงูุฎุทูุฉ 2: ุทูุจ ุฃู ูุตุจุญ ุชุงุฌุฑ
```
1. ูุฐูุจ ูู /merchant
2. ูููุฃ ูููุฐุฌ ุทูุจ ุงูุชุงุฌุฑ
3. ูุถุบุท "ุฅุฑุณุงู ุงูุทูุจ"
โ ุงููุชูุฌุฉ: ุทูุจ ูู merchant_requests
```

### ุงูุฎุทูุฉ 3: ููุงููุฉ ุงูุฃุฏูู
```
1. ุงูุฃุฏูู ูุฐูุจ ูู /admin/merchant-requests
2. ูุฑุงุฌุน ุงูุทูุจ
3. ูุถุบุท "ูุจูู"
โ ุงููุชูุฌุฉ: role = merchant
```

### ุงูุฎุทูุฉ 4: ุฅุถุงูุฉ ุงููุชุฌุฑ ุงูุฃูู
```
1. ุงูุชุงุฌุฑ ูุฐูุจ ูู /merchant
2. ูุถุบุท "ุฅุถุงูุฉ ูุชุฌุฑ"
3. ูููุฃ ุงูุจูุงูุงุช
4. ูุฎุชุงุฑ ุตูุฑุฉ (ูุชู ุงูุชุญูู: ุญุฌูุ ููุนุ ุงูุชุฏุงุฏ)
5. ูุฎุชุงุฑ ูุซููุฉ PDF (ูุชู ุงูุชุญูู)
6. ูุถุบุท "ุฅุถุงูุฉ ุงููุชุฌุฑ"
โ ุงููุชูุฌุฉ: ูุชุฌุฑ ุฌุฏูุฏ (is_active = false)
โ ุนุฏุฏ ุงููุชุงุฌุฑ: 1/10
```

### ุงูุฎุทูุฉ 5: ูุญุงููุฉ ุฑูุน ููู PHP
```
1. ุงูุชุงุฌุฑ ูุญุงูู ุฑูุน ููู .php ูุดุนุงุฑ
โ Frontend: ูุฑูุถ ุงูููู ููุฑุงู
โ ุฑุณุงูุฉ: "ูุฐุง ุงูููุน ูู ุงููููุงุช ุบูุฑ ูุณููุญ ุจู"
โ ุงููุชูุฌุฉ: ุญูุงูุฉ ูุงููุฉ
```

### ุงูุฎุทูุฉ 6: ุฅุถุงูุฉ 9 ูุชุงุฌุฑ ุฅุถุงููุฉ
```
ููุฑุฑ ุงูุฎุทูุฉ 4 ุชุณุน ูุฑุงุช
โ ุงููุชูุฌุฉ: 10 ูุชุงุฌุฑ (ุงูุญุฏ ุงูุฃูุตู)
```

### ุงูุฎุทูุฉ 7: ูุญุงููุฉ ุฅุถุงูุฉ ูุชุฌุฑ 11
```
1. ูุถุบุท "ุฅุถุงูุฉ ูุชุฌุฑ"
2. ูููุฃ ุงูุจูุงูุงุช
3. ูุถุบุท "ุฅุถุงูุฉ ุงููุชุฌุฑ"
โ Frontend: "ููุฏ ูุตูุช ููุญุฏ ุงูุฃูุตู ูู ุงููุชุงุฌุฑ (10 ูุชุงุฌุฑ)"
โ Database: Exception ุญุชู ูู ุชุฌุงูุฒ Frontend
โ ุงููุชูุฌุฉ: ูุญูู ุชูุงูุงู
```

### ุงูุฎุทูุฉ 8: ููุงููุฉ ุงูุฃุฏูู ุนูู ุงููุชุฌุฑ
```
1. ุงูุฃุฏูู ูุฐูุจ ูู /admin/stores
2. ูุฑู ุงููุชุฌุฑ ุงูุฌุฏูุฏ (is_active = false)
3. ูุนุฑุถ ุงูุชูุงุตูู
4. ูุชุฃูุฏ ูู ุงููุซุงุฆู
5. ูุถุบุท ุฒุฑ ุงูุชูุนูู
โ ุงููุชูุฌุฉ: is_active = true
```

### ุงูุฎุทูุฉ 9: ุธููุฑ ุงููุชุฌุฑ ููุนุงูุฉ
```
1. ุฃู ุฒุงุฆุฑ ูุฐูุจ ูู /stores
2. ูุฑู ุงููุชุฌุฑ ุงูููุนูู
โ ุงููุชูุฌุฉ: ุงููุชุฌุฑ ูุธูุฑ ูุจุงุดุฑุฉ
```

---

## ๐ง ุงุฎุชุจุงุฑุงุช ุฅุถุงููุฉ ููุชุฑุญุฉ

### 1. ุงุฎุชุจุงุฑ ุงูุฃูุงู ุงููุชูุฏู:
- [ ] ูุญุงููุฉ ุฑูุน ููู .php.jpg (double extension)
- [ ] ูุญุงููุฉ ุฑูุน ููู ุจู MIME ูุฒูู
- [ ] ูุญุงููุฉ ุฑูุน ููู ุฃูุจุฑ ูู 5MB
- [ ] ูุญุงููุฉ ุงููุตูู ููููุงุช ูุณุชุฎุฏู ุขุฎุฑ

### 2. ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก:
- [ ] ุฑูุน 100 ุตูุฑุฉ ูุชุชุงููุฉ
- [ ] ุนุฑุถ ุตูุญุฉ ุจูุง 1000 ูุชุฌุฑ
- [ ] ุงูุจุญุซ ูุงูููุชุฑุฉ ูุน ุนุฏุฏ ูุจูุฑ

### 3. ุงุฎุชุจุงุฑ UX:
- [ ] ุฑุณุงุฆู ุงูุฎุทุฃ ูุงุถุญุฉ
- [ ] Loading states
- [ ] Toast notifications
- [ ] Form validation

---

## โ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

### ุฌููุน ุงููุชุทูุจุงุช ูุญููุฉ:

โ **1. ุชุณุฌูู ุงูุชุงุฌุฑ**: ูุธุงู ูุงูู ูุน ููุงููุฉ ุงูุฃุฏูู  
โ **2. ุญุฏ 10 ูุชุงุฌุฑ**: ูุญูู ุจู Trigger + Frontend  
โ **3. ููุน PHP**: 4 ุทุจูุงุช ุญูุงูุฉ  
โ **4. ุฑูุน ุงูุตูุฑ**: ุขูู ููุญูู ุจุงููุงูู  
โ **5. ููุงููุฉ ุงูุฃุฏูู**: ุชูุนูู ูุฏูู  
โ **6. ุงูุธููุฑ ุงูุชููุงุฆู**: ุนูุฏ is_active = true  

### ุงูุฃูุงู ุงููุทุจู:
- ๐ Database Triggers
- ๐ RLS Policies  
- ๐ Storage Restrictions
- ๐ Frontend Validation
- ๐ MIME Type Checks
- ๐ File Extension Blocks

ุงููุธุงู ุฌุงูุฒ ููุฅูุชุงุฌ! ๐